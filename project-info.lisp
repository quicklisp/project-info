;;;; project-info.lisp

(in-package #:project-info)

(defparameter *guess-website-patterns*
  '(("//github.com/(.*)\\.git" "https://github.com/" 0 "/")
    ("//github.com/(.*)$" "https://github.com/" 0 "/")
    ("//mr.gy/(.*?)/(.*?)/" "http://mr.gy/" 0 "/" 1 "/")
    ("(common-lisp\\.net/projects?/.*?/)" "http://" 0)
    ("^(.*bitbucket.*)$" 0)))

(defun substitute-if-matches (regex target substitution)
  (multiple-value-bind (start end anchor-starts anchor-ends)
      (ppcre:scan regex target)
    (labels ((anchor-substring (index)
               (subseq target
                       (aref anchor-starts index)
                       (aref anchor-ends index)))
             (maybe-substitute (object)
               (etypecase object
                 (string object)
                 (integer (anchor-substring object)))))
      (when (and start end)
        (format nil "窿磲疸狎＇磲忮篚怏糸趱翦篚怏糸趱糸镱┅┅┅ㄤ彐躅珲弩蟓麇怏轸瀛怡祜汜糸镱疳趑弪祜汜糸镱ㄤ镬轶箴邈珲弩蟓麇怏轸瀛疳趑弪铙ㄤ弩趄蹉趱蜷铉忾钿蝈珏篚怏糸趱糸镱箴邈戾è篚怏糸趱糸镱篚怏糸趱翦殒磲翥桢蝈珏祜汜糸镱篚怏糸趱糸镱┅麒孱篚怏糸趱糸镱蝈趱蝾篚怏糸趱糸镱┅┅┅ㄤ彐躅珲弩蟓麇怏轸ㄩ铈铹ㄤ弩趄蹉趱蜷铉忾钿é脲豉疱祜汜糸镱屮趄岍轭骘ㄤ邈灬蝈ㄩ珙矧豉疱屮趄岍矧ㄧ蹂篌麇怏轸瀛怡祜汜糸镱疳趑弪祜汜糸镱ㄥ蝌矧⒚犷铒珲弩麇怏轸骘骝镯英痱镪邈轭骘┅┅ㄤ彐躅溴骟篝屙骘蝽轭骘ㄤ彐簌篝屙扉篝侯犴篝蜷铉滹黝汜箦箦泔钿溴骟篝屙┅红殂孱箦矧ㄧ弭溴骟篝屙红殂孱箦ㄧ弭溴骟篝屙红殂孱沐┅轰弩泸轲糸镱ㄧ弭溴骟篝屙轰弩泸轲糸镱鸿镯屦徵ㄧ弭溴骟篝屙鸿镯屦徵濠横豸栾ㄧ弭溴骟篝屙横豸栾颟忽弪箝镱ㄧ弭溴骟篝屙忽弪箝镱┅ㄤ彐躅簌篝屙骈戾轭骘簌篝屙骈戾⒁遽淤釉磐粕膛犷祜镫骘呐朴儆耘骘蝽磲翥栝铉轸疳翳钺礤钺礤义趱蝾翳轭翦蝈篝轭痱镳弪糸弩镦翳骘蝽扉沐铙瀣溴筱蜷痿轱瞵疱蜩狃盹蝈狍痨轶舢鏖翳镳孱骈戾篝蝈犴簌篝屙骈戾戾舄è祜徜趄蹂钺礤趄蹂钺礤簌篝屙骈戾┅í祜徜疳翳钺礤祜徜趄蹂钺礤í蝈徜弼犰铋飑í溴驷蹯舡疳翳钺礤溴驷蹯趔磲脲疳翳钺礤侯犴铋呼疱铋忽弪箝镱铋轰彐狨祠祜徜趄蹂钺礤┅ㄣ骀榄珧秭屐ㄦ轭洵疳汶徵В恒骀榄珧秭屐┅躅戾篌沔骈珧秭屐戾è疳汶徵磲脲疳汶徵В恒骀榄珧秭屐┅戾è簌礅镬ㄩ铘弪⑶蚁峙汰粕膛疳汶徵濠┅ㄥ痫螋簌礅镬疳汶徵濠┅躅鏖钿痱雉邈祜镳鏖翳骈戾钺礤疳翳钺礤钺礤簌篝屙骈戾骘骘蝽蝈徜篝蝈犴铋篝蝈犴躅糸ㄥ骘蝽篝蝈犴麒孱ㄡ钿ㄣ镱箴骘蝽篝蜷铉羼踽ㄦ轵篝骘蝽⒛牌淤釉磐篝蜷铉羼踽箦泔钿骘蝽骈戾钺礤┅蝈趱蝾ㄤ彐簌篝屙骘蝽轭骘骘蝽┅躅戾篌沔骈珧秭屐ㄤ屐弭瀛疳汶徵В恒骀榄珧秭屐┅┅┅ㄤ彐躅翦篝簌篝屙疳翳钺礤箦狎汨翦篝钺礤篝蜷铉疳翳钺礤┅＋蝈聃轵弩耢溟篝ㄤ彐躅痱镪邈舡簌篝屙骈戾痱镪邈舂戾è蝈戾狍ㄦ轭洵蝈戾狍痱镪邈舂┅躅戾篌蝈戾狍ㄥ蝌矧⒚秕熹铒骈钿蝈戾狍骘立痱镪邈舂ㄥ铙躜瀛轭篝犰戾蝈戾狍濠祜镳骘骈戾轭簌篝屙骈戾蝈戾狍濠躅戾篌翦篝簌篝屙骈戾泔祆邈趄蹂钺礤蝈灬糸鲥麸蝈戾狍骈戾┅┅＋蝈聃轵弩耢溟篝ㄤ彐躅痱轫狎簌篝屙骈戾痱镪邈舂戾è簌篝屙骈戾痱镪邈舡簌篝屙骈戾痱镪邈舂┅ㄣ镱è铛祆蝈篝簌篝屙骈戾螬ㄦ轵篝簌篝屙骈戾螬è骈钿痱镪邈痱镪邈舡簌篝屙骈戾痱镪邈舂呼弩篝蜷铉羼踽弘妁ю狒桀犴瀛钺礤┅铋飑┅ㄤ彐躅骒狒翦瞽篝蜷铉篝蜷铉⒁弭躜釉疑吻鏖翳犰铄黛轭弩犷雉桢麒轸弩疳沐泔铞弪翦麸箴徙弩痧泸搴蝈珏蝈痨徙瀛犰④荏篝蜷铉┅ㄤ彐躅沆殡榄孱泔溴篝蜷铉箦翩篝蜷铉篚怏糸趱翦＼＼羽徙篝蜷铉┅ㄤ蜥腠岷躜飙孱泔溴篝蜷铉乎翩俯ㄤ彐躅沆殡榄扉铍痱镪邈舂ㄦ矧磲铋㈣趑鸷沆殡楫铄舣立ㄣ扉腴孱泔溴痱镪邈舂┅｜ㄤ彐躅痱轫狎簌篝屙轭骘痱镪邈舂戾舄è簌篝屙痱轫狎簌篝屙骈戾痱镪邈舂ㄩ铈ㄡ钿簌篝屙簌篝屙骈戾轭骘簌篝屙┅┅轭骘┅ㄤ彐躅痱轫狎簌篝屙痱镳弪豉痱镪邈轭溟汜麸颟ㄧ弭痱轫狎簌篝屙轭骘痱镪邈舂轭溟汜麸颟ㄤ彐躅痱轫狎簌篝屙麇怏轸痱镪邈舂痱轫狎簌篝屙痱镳弪豉痱镪邈鸿镯屦徵濠ㄤ彐躅痱轫狎簌篝屙溴筱蜷痿轱痱镪邈舂戾è溴筱蜷痿轱痱轫狎簌篝屙痱镳弪豉痱镪邈轰弩泸轲糸镱┅麒孱ㄡ钿篝蜷铉溴筱蜷痿轱瞟痨躞戾铉翳溴筱蜷痿轱瞟┅ㄦ灬趑孱篝蜷铉溴筱蜷痿轱瞟┅ㄤ彐躅痱轫狎簌篝屙扉沐铙痱镪邈舂痱轫狎簌篝屙痱镳弪豉痱镪邈红殂孱箦┅ㄤ彐躅痱镪邈舡麇怏轸痱镪邈舂矧痱轫狎簌篝屙麇怏轸痱镪邈舂ㄧ蹂篌麇怏轸痱镪邈舂ㄣ扉腴扉铍痱镪邈舂┅ㄤ彐躅玳翳踱痱镳弪糸弩躜飑痧泸搴蝈玳篝弪珧秕痼忾钿躞弪蝈痫á玳翳踱泔懑ó咯ó咯ê寇墚玳舂郡躜飑扉篝乎箦躞弪候屦蝈痫┅ㄤ彐鲠玳翳踱汜汨濯磲脲栳箬翎忪呼弩у聃犰皓ㄤ彐躅珏舡玳翳踱蝈痫轭骘痱镪邈舂戾舄è轭骘痱镪邈舡轭骘痱镪邈舂祜汜糸镱ㄧ弭轭骘红镢狒轱瞟ㄧ轸桴ㄧ轸桴猸痱镳弪糸弩祜汜糸镱┅麒孱玳翳踱戾è蝈痫轭骘躜ㄦ矧磲铋㈣趑痼函狃楫玳翳踱泔懑蝈痫蟑怜立ㄧ弭玳翳踱乎箦颟ㄧ弭玳翳踱候屦铹┅眭祠轲戾鲠祯瀛忾钿ㄢ镤篝狒躞ㄤ蜥腠岷梏麴蝈聃弩蝈痫轭骘躜飑麒孱ㄥ耢篝狒躞舶癌狍镱吼狎箦ㄢ徕屐猴泗弭蟓麸篝蜷铉怙澌哄钽镤轭乎翩俯┅┅┅ㄤ彐躅玳翳踱蝈痫轭骘痱镪邈舂眭祠轲戾鲠祯瀛忾钿ㄩ铈骘躅漯ㄧ弭栳箬痱镪邈玳翳踱汜汨濯ㄩ骘躅漯轭骘箦翩ㄧ弭栳箬痱镪邈玳翳踱汜汨濯ㄧ弭玳翳踱蝈痫轭骘痱镪邈舂┅┅ㄤ彐躅玳翳踱溴筱蜷痿轱痱镪邈舂戾è轭骘ㄧ轸桴猸蝈痫轭骘痱镪邈舂┅麒孱轭骘鲠祯弩ㄧ弭栳箬溴筱蜷痿轱睥轭骘┅┅ㄤ彐躅痱镪邈舡溴筱蜷痿轱痱镪邈舂矧痱轫狎簌篝屙溴筱蜷痿轱痱镪邈舂ㄧ轸桴猸溴筱蜷痿轱痱镪邈舂┅ㄤ彐躅痱镪邈舡扉沐铙痱镪邈舂痱轫狎簌篝屙扉沐铙痱镪邈舂ㄤ彐躅痱镪邈舡犷铒躅沐轭骘痱镪邈舂扉篝侯犴痱镪邈红殂孱箦矧痱镪邈舡扉沐铙痱镪邈舂⒄铙疱汩骈邃瑚邂箝翦痱镪邈舡麇怏轸痱镪邈舂轰弩泸轲糸镱矧痱镪邈舡溴筱蜷痿轱痱镪邈舂⒄铙疱汩骈邃┅